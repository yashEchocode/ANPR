<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Number Plate Detection</title>
    <!-- Adding Google Fonts for better typography -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f3f3f3;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f9f9f9;
            font-weight: bold;
        }

        .led-container {
        margin-top: 20px;
        padding: 15px 0; /* Vertical padding */
      }

      .led {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        margin-right: 10px;
      }

      .led-red {
        background-color: #ff4d4d; /* Red color */
        box-shadow: 0 0 20px #ff4d4d, inset 0 0 10px #ff3333;
      }

      .led-green {
        background-color: #00cc00; /* Green color */
        box-shadow: 0 0 20px #00cc00, inset 0 0 10px #00b300;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <h1 class="display-6">ANPR System</h1>
                <p class="text-white">Automatic Number Plate Detection System</p>
            </a>
        </div>
    </nav>
    <div class="container">
        <div class="text-center d-flex justify-content-center align-items-center">
            <div class="col-auto">
                <p class="text-center m-0 px-3" id="status"></p>
            </div>
            <div class="col-auto">
                <div class="led-container text-center d-flex justify-content-center align-items-center m-0 px-3">
                    <div class="led" id="led"></div>
                </div>
            </div>
            
        </div>
        <table>
            <thead>
                <tr>
                    <th>Vehicle Number</th>
                    <th>Role</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="vehicle-list">
                <tr id="loading-text">
                    <td colspan="3" class="loading text-center">
                        <div class="d-flex justify-content-center align-items-center" style="height: 200px;">
                            <div class="spinner-border" role="status"></div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <script>
        // Function to capitalize first letter and convert the rest to lowercase
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();
        }

        var socket = io(); // Connect to SocketIO server
        var uniquePrevisos = {}; // Maintain a dictionary to store unique previsos

        socket.on('connect', function() {
            console.log('Connected to server');
        });

        socket.on('disconnect', function() {
            console.log('Disconnected from server');
        });

        // Function to update vehicle list with received data
        // Function to update vehicle list with received data
function updateVehicleList(data) {
    var vehicleList = document.getElementById('vehicle-list');
    var loadingText = document.getElementById('loading-text');
    let led = document.getElementById('led');
    let status = document.getElementById('status');

    loadingText.style.display = 'none'; // Hide loading text

    var previousEntry = null; // Variable to store previous entry

    data.forEach(vehicle => {
        // Check if the previsos is already in the uniquePrevisos dictionary
        if (vehicle.number !== previousEntry) {
            uniquePrevisos[vehicle.number] = true; // Mark previsos as seen
            var row = document.createElement('tr');
            row.innerHTML = `
                <td>${vehicle.number || '-'}</td>
                <td>${vehicle.vehicleData.length > 0 ? capitalizeFirstLetter(vehicle?.vehicleData[0][1]) : "No Data Found"}</td>
                <td>${vehicle.vehicleData.length > 0 ? "Authorized" : "Unauthorized"} Vehicle</td>
            `;
            if (vehicle.vehicleData.length > 0) {
                led.classList.remove('led-red');
                led.classList.add('led-green');
                status.textContent = "Authorized Vehicle";
            } else {
                led.classList.remove('led-green');
                led.classList.add('led-red');
                status.textContent = "Unauthorized Vehicle";
            }
            vehicleList.appendChild(row);
            previousEntry = vehicle.number; // Update previous entry
        }
    });
}


        // Handle 'vehicle_detected' event
        socket.on('vehicle_detected', function(data) {
            console.log('Received vehicle data:', data);
            updateVehicleList([data]); // Update vehicle list with received data
        });
    </script>


    
    
</body>
</html>
